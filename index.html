<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#4f46e5">
<link rel="manifest" href="manifest.json">
<title>Budget Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
       background: linear-gradient(180deg,#a78bfa 0%,#f9a8d4 100%);
       margin:0;padding:0;color:#fff;min-height:100vh;
       display:flex;flex-direction:column;align-items:center; }
header{text-align:center;margin-top:1rem;}
h1{margin:0;font-size:1.8rem;}
.container{width:90%;max-width:500px;background:rgba(255,255,255,0.15);
  padding:1rem;border-radius:1rem;margin-top:1rem;box-shadow:0 4px 10px rgba(0,0,0,0.2);
  backdrop-filter: blur(10px);}
input,select,button{width:100%;padding:0.6rem;border:none;border-radius:0.5rem;margin-top:0.5rem;}
button{background-color:#4f46e5;color:white;font-weight:bold;}
.list{margin-top:1rem;max-height:250px;overflow-y:auto;}
.item{background: rgba(0,0,0,0.1); border-radius:0.5rem;
  padding:0.4rem 0.6rem; display:flex; justify-content:space-between; align-items:center; margin-bottom:0.3rem;}
.balance{font-size:1.5rem;font-weight:bold;text-align:center;margin-top:1rem;}
canvas{margin-top:1rem;background:rgba(255,255,255,0.15);border-radius:1rem;padding:0.5rem;}
.goal-summary{margin-top:1rem;}
.goal-item{margin-bottom:0.5rem; display:flex; flex-direction:column;}
.progress-bar{background:#fff3;border-radius:0.3rem;height:1rem;position:relative;margin:0.3rem 0;}
.progress-fill{height:100%;border-radius:0.3rem;}
</style>
</head>
<body>
<header>
<h1>ðŸ’° Budget Tracker</h1>
<div class="balance" id="balance">Balance: $0</div>
</header>

<div class="container">
<input type="number" id="amount" placeholder="Amount">
<input type="text" id="note" placeholder="Description">
<select id="category">
  <option>General</option>
  <option>Food</option>
  <option>Rent</option>
  <option>Travel</option>
  <option>Utilities</option>
  <option>Entertainment</option>
</select>
<select id="type">
  <option value="income">Income</option>
  <option value="expense">Expense</option>
</select>
<input type="month" id="monthFilter" onchange="update()">
<input type="date" id="date">
<button onclick="addTransaction()">Add</button>

<div class="list" id="list"></div>

<h3>Category Goals</h3>
<div id="goalList" class="goal-summary"></div>
<input type="text" id="goalCategory" placeholder="Category Name">
<input type="number" id="goalAmount" placeholder="Monthly Goal">
<button onclick="setGoal()">Set Goal</button>

<h3>History</h3>
<select id="monthHistory" onchange="loadMonth(this.value)">
  <option value="">Current Month</option>
</select>

<h3>Current Month vs Goal</h3>
<canvas id="chartBar" height="180"></canvas>

<h3>Historical Spending by Category</h3>
<canvas id="chartLine" height="180"></canvas>
</div>

<script>
function randomColor(){return '#'+Math.floor(Math.random()*16777215).toString(16);}
let data=JSON.parse(localStorage.getItem('budgetData'))||{transactions:[],categoryGoals:{},lastMonth:new Date().toISOString().slice(0,7),history:{}};
const today=new Date();
const currentMonth=today.toISOString().slice(0,7);

// Auto reset month
if(data.lastMonth!==currentMonth){
  data.history[data.lastMonth]=data.transactions;
  data.transactions=[];
  data.lastMonth=currentMonth;
  localStorage.setItem('budgetData',JSON.stringify(data));
}

// Dynamic category dropdown
function updateCategoryDropdown(){
  const select=document.getElementById('category');
  const existing=Array.from(select.options).map(o=>o.value);
  for(const cat of Object.keys(data.categoryGoals)){
    if(!existing.includes(cat)){
      const option=document.createElement('option');
      option.value=cat;
      option.textContent=cat;
      select.appendChild(option);
    }
  }
}

// Populate history dropdown
function populateHistory(){
  const sel=document.getElementById('monthHistory');
  sel.innerHTML='<option value="">Current Month</option>';
  for(const m of Object.keys(data.history).sort().reverse()){
    sel.innerHTML+=`<option value="${m}">${m}</option>`;
  }
}

// Charts
let barChart, lineChart;

function update(){
  updateCategoryDropdown();
  populateHistory();
  const list=document.getElementById('list'); list.innerHTML='';
  const monthFilter=document.getElementById('monthFilter').value;
  let balance=0;
  const filtered=monthFilter?data.transactions.filter(t=>t.date.slice(0,7)===monthFilter):data.transactions;
  filtered.forEach((t,i)=>{
    const div=document.createElement('div'); div.className='item';
    div.innerHTML
