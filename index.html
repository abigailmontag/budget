<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#4f46e5">

  <link rel="manifest" href="manifest.json">

<!-- iOS-specific icons and settings -->
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Budget Tracker">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link rel="manifest" href="manifest.json">
<title>Budget Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
/* ----------------- BODY & BACKGROUND ----------------- */
body {
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  margin:0;padding:0;color:#fff;min-height:100vh;
  display:flex;flex-direction:column;align-items:center;
  background: linear-gradient(180deg,#3b82f6,#8b5cf6,#f472b6,#fb923c);
  animation: bgShift 15s infinite alternate;
  transition: background 3s ease-in-out;
}

@keyframes bgShift {
  0% {background:linear-gradient(180deg,#3b82f6,#8b5cf6,#f472b6,#fb923c);}
  50%{background:linear-gradient(180deg,#8b5cf6,#f472b6,#fb923c,#3b82f6);}
  100%{background:linear-gradient(180deg,#3b82f6,#8b5cf6,#f472b6,#fb923c);}
}

/* ----------------- CONTAINER ----------------- */
header{text-align:center;margin-top:1rem;}
h1{margin:0;font-size:1.8rem;text-shadow:0 2px 6px rgba(0,0,0,0.5);}
.container {
  width:90%;max-width:500px;
  background:rgba(255,255,255,0.15);
  padding:1rem;border-radius:1rem;
  margin-top:1rem;
  box-shadow:0 8px 20px rgba(0,0,0,0.3);
  backdrop-filter: blur(15px);
  transition: transform 0.2s;
}
.container:hover {transform: translateY(-3px);}

/* ----------------- INPUTS & BUTTONS ----------------- */
input,select,button{
  width:100%;padding:0.7rem;border:none;border-radius:0.6rem;margin-top:0.5rem;
  transition: box-shadow 0.2s;
}
input:focus,select:focus{outline:none;box-shadow:0 0 8px #fff;}
button{
  background-color:#8b5cf6;color:white;font-weight:bold;
  box-shadow:0 4px 10px rgba(0,0,0,0.2);
  transition: transform 0.1s, box-shadow 0.2s;
}
button:hover{transform: scale(1.03);box-shadow:0 6px 14px rgba(0,0,0,0.3);}

/* ----------------- LIST & ITEMS ----------------- */
.list{margin-top:1rem;max-height:250px;overflow-y:auto;}
.item{
  background: rgba(0,0,0,0.15); border-radius:0.6rem;
  padding:0.5rem 0.7rem; display:flex; justify-content:space-between; align-items:center; margin-bottom:0.4rem;
  transition: background 0.2s;
}
.item:hover{background: rgba(0,0,0,0.25);}

/* ----------------- BALANCE ----------------- */
.balance{font-size:1.6rem;font-weight:bold;text-align:center;margin-top:1rem;text-shadow:0 2px 6px rgba(0,0,0,0.5);}

/* ----------------- CHARTS ----------------- */
canvas{margin-top:1rem;background:rgba(255,255,255,0.15);border-radius:1rem;padding:0.5rem;}

/* ----------------- GOALS & PROGRESS ----------------- */
.goal-item{margin-bottom:0.6rem;}
.progress-bar{
  background: rgba(255,255,255,0.3);
  border-radius:0.4rem;height:1.2rem;position:relative;overflow:hidden;
}
.progress-fill{
  height:100%;border-radius:0.4rem;
  transition: width 0.5s ease;
  background: linear-gradient(90deg,#3b82f6,#8b5cf6,#f472b6,#fb923c);
}
</style>
</head>
<body>
<header>
<h1>üí∞ Budget Tracker</h1>
<div class="balance" id="balance">Balance: $0</div>
</header>

<div class="container">
<!-- Add Transaction -->
<input type="number" id="amount" placeholder="Amount">
<input type="text" id="note" placeholder="Description">
<select id="category">
  <option>General</option>
  <option>Food</option>
  <option>Rent</option>
  <option>Travel</option>
  <option>Utilities</option>
  <option>Entertainment</option>
</select>
<select id="type">
  <option value="income">Income</option>
  <option value="expense">Expense</option>
</select>
<input type="month" id="monthFilter" onchange="update()">
<input type="date" id="date">
<button type="button" onclick="addTransaction()">Add</button>

<div class="list" id="list"></div>

<!-- Goals -->
<h3>Category Goals</h3>
<div id="goalList" class="goal-summary"></div>
<input type="text" id="goalCategory" placeholder="Category Name">
<input type="number" id="goalAmount" placeholder="Monthly Goal">
<button type="button" onclick="setGoal()">Set Goal</button>

<!-- Charts -->
<h3>Current Month vs Goal</h3>
<canvas id="chartBar" height="180"></canvas>

<h3>Historical Spending by Category</h3>
<canvas id="chartLine" height="180"></canvas>

<!-- History Dropdown -->
<h3>History</h3>
<select id="monthHistory" onchange="loadMonth(this.value)">
  <option value="">Current Month</option>
</select>
</div>

<script>
function randomColor(){return '#'+Math.floor(Math.random()*16777215).toString(16);}
let data=JSON.parse(localStorage.getItem('budgetData'))||{transactions:[],categoryGoals:{},lastMonth:new Date().toISOString().slice(0,7),history:{}};
const today=new Date();
const currentMonth=today.toISOString().slice(0,7);

// Auto reset month
if(data.lastMonth!==currentMonth){
  data.history[data.lastMonth]=data.transactions;
  data.transactions=[];
  data.lastMonth=currentMonth;
  localStorage.setItem('budgetData',JSON.stringify(data));
}

// Update category dropdown dynamically
function updateCategoryDropdown(){
  const select=document.getElementById('category');
  const existing=Array.from(select.options).map(o=>o.value);
  for(const cat of Object.keys(data.categoryGoals)){
    if(!existing.includes(cat)){
      const option=document.createElement('option');
      option.value=cat;
      option.textContent=cat;
      select.appendChild(option);
    }
  }
}

// Populate history dropdown
function populateHistory(){
  const sel=document.getElementById('monthHistory');
  sel.innerHTML='<option value="">Current Month</option>';
  for(const m of Object.keys(data.history).sort().reverse()){
    sel.innerHTML+=`<option value="${m}">${m}</option>`;
  }
}

let barChart,lineChart;

function update(){
  updateCategoryDropdown();
  populateHistory();
  const list=document.getElementById('list'); list.innerHTML='';
  const monthFilter=document.getElementById('monthFilter').value;
  let balance=0;
  const filtered=monthFilter?data.transactions.filter(t=>t.date.slice(0,7)===monthFilter):data.transactions;
  filtered.forEach((t,i)=>{
    const div=document.createElement('div'); div.className='item';
    div.innerHTML=`<span>${t.date} ‚Ä¢ ${t.category} ‚Ä¢ ${t.note}</span>
                   <span>${t.type==='income'?'+':'-'}$${t.amount.toFixed(2)}</span>
                   <button type="button" style="background:none;border:none;color:white;font-size:1rem" onclick="removeTransaction(${i})">üóëÔ∏è</button>`;
    list.appendChild(div);
    balance+=t.type==='income'?t.amount:-t.amount;
  });
  document.getElementById('balance').textContent='Balance: $'+balance.toFixed(2);
  renderGoals(filtered);
  renderCharts(filtered);
  localStorage.setItem('budgetData',JSON.stringify(data));
}

// Add Transaction
function addTransaction(){
  const amount=parseFloat(document.getElementById('amount').value);
  const note=document.getElementById('note').value;
  const type=document.getElementById('type').value;
  const category=document.getElementById('category').value;
  const date=document.getElementById('date').value||new Date().toISOString().slice(0,10);
  if(!amount||!note)return alert('Enter amount and description');
  data.transactions.push({amount,note,type,category,date});
  document.getElementById('amount').value=''; document.getElementById('note').value='';
  update();
}

// Remove Transaction
function removeTransaction(index){data.transactions.splice(index,1);update();}

// Set Goal
function setGoal(){
  const category=document.getElementById('goalCategory').value.trim();
  const amount=parseFloat(document.getElementById('goalAmount').value);
  if(!category||!amount)return alert('Enter category and goal amount');
  data.categoryGoals[category]=amount;
  document.getElementById('goalCategory').value='';
  document.getElementById('goalAmount').value='';
  update();
}

// Render Goals with animated gradient progress bars
function renderGoals(filtered){
  const goalList=document.getElementById('goalList'); goalList.innerHTML='';
  for(const [cat,goal] of Object.entries(data.categoryGoals)){
    const spent=filtered.filter(t=>t.category===cat && t.type==='expense').reduce((sum,t)=>sum+t.amount,0);
    const diff=goal-spent;
    const pct=Math.min((spent/goal)*100,100);
    const div=document.createElement('div'); div.className='goal-item';
    div.innerHTML=`<span>${cat}</span>
    <div class="progress-bar"><div class="progress-fill" style="width:${pct}%;background:linear-gradient(90deg,#3b82f6,#8b5cf6,#f472b6,#fb923c)"></div></div>
    <span>Spent: $${spent.toFixed(2)}/$${goal.toFixed(2)} (<strong>${diff>=0?'+':'-'}$${Math.abs(diff).toFixed(2)}</strong>)</span>`;
    goalList.appendChild(div);
  }
}

// Render Charts: Bar + Line
function renderCharts(filtered){
  const ctxBar=document.getElementById('chartBar').getContext('2d');
  const ctxLine=document.getElementById('chartLine').getContext('2d');

  // Bar chart
  const categories={}; for(const cat in data.categoryGoals) categories[cat]=0;
  filtered.filter(t=>t.type==='expense').forEach(t=>{if(categories[t.category]!==undefined) categories[t.category]+=t.amount;});
  const labels=Object.keys(categories);
  const spent=Object.values(categories);
  const goals=labels.map(l=>data.categoryGoals[l]);
  const barData={labels,datasets:[
    {label:'Spent',data:spent,backgroundColor:'#f472b6'},
    {label:'Goal',data:goals,backgroundColor:'#3b82f6AA'}
  ]};
  if(barChart) barChart.destroy();
  barChart=new Chart(ctxBar,{
    type:'bar',
    data:barData,
    options:{
      plugins:{
        legend:{labels:{color:'#fff'}},
        tooltip:{
          callbacks:{
            label:function(context){return `${context.dataset.label}: $${context.parsed.y.toFixed(2)}`;}
          }
        }
      },
      scales:{x:{ticks:{color:'#fff'}},y:{ticks:{color:'#fff'}}}
    }
  });

  // Line chart historical
  const months=Object.keys(data.history).sort();
  if(months.length>0){
    const lineDatasets=Object.keys(data.categoryGoals).map(cat=>{
      return {
        label:cat,
        data:months.map(m=>{
          const monthData=data.history[m]||[];
          return monthData.filter(t=>t.category===cat && t.type==='expense').reduce((sum,t)=>sum+t.amount,0);
        }),
        borderColor: randomColor(),
        fill:false,
        tension:0.3
      }
    });
    if(lineChart) lineChart.destroy();
    lineChart=new Chart(ctxLine,{
      type:'line',
      data:{labels:months,datasets:lineDatasets},
      options:{plugins:{legend:{labels:{color:'#fff'}},
                tooltip:{callbacks:{label:function(c){return `${c.dataset.label}: $${c.parsed.y.toFixed(2)}`;}}}},
               scales:{x:{ticks:{color:'#fff'}},y:{ticks:{color:'#fff'}}}}
    });
  }
}

// Load historical month
function loadMonth(month){
  if(!month){data.transactions=[];update();return;}
  data.transactions=data.history[month]||[];
  update();
}

if('serviceWorker' in navigator) navigator.serviceWorker.register('service-worker.js');
update();
</script>
</body>
</html>
